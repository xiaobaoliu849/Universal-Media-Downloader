<!DOCTYPE html>
<html>
<head>
    <title>流光下载器</title>
    <meta charset="utf-8">
    <!-- Favicon 修复：项目中不存在 favicon.svg/favicon.ico，使用 icon.ico 与 SVG 主 Logo -->
    <link rel="icon" type="image/x-icon" href="/static/icon.ico">
    <link rel="alternate icon" type="image/svg+xml" href="/static/video_downloader_logo.svg">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <!-- 顶部Logo和标题 -->
        <div class="header">
            <div class="header-content">
                <img src="/static/video_downloader_logo.svg" class="logo" alt="流光下载器 Logo">
                <h1>流光下载器</h1>
            </div>
        </div>

        <!-- 主要输入区域 -->
        <div class="input-container">
            <div class="input-row">
                <input type="text" id="videoUrl" placeholder="粘贴视频或播放列表链接..." required>
            </div>
            <div id="error-message" style="color: red; margin-bottom: 15px; display: none;"></div>

            <div class="video-info" id="videoInfo">
                <h3 id="videoTitle">视频标题</h3>
                <p id="videoDetails">详细信息</p>
            </div>

            <div class="options-row">
                <div class="option-group">
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="merged" name="downloadMode" value="merged" checked>
                            <label for="merged">📹 合并</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="video" name="downloadMode" value="video">
                            <label for="video">🎬 仅视频</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="audio" name="downloadMode" value="audio">
                            <label for="audio">🎵 仅音频</label>
                        </div>
                        <div class="radio-option">
                            <input type="radio" id="thumbnail" name="downloadMode" value="thumbnail">
                            <label for="thumbnail">🖼️ 仅封面</label>
                        </div>
                    </div>
                </div>
                <div class="download-group">
                    <button class="download-btn" onclick="downloadMedia()">📥 下载媒体</button>
                </div>
            </div>

            <!-- 元数据开关：简单，不占主视图宽度 -->
            <div style="margin: -10px 0 20px 0; font-size:13px; color:#374151; text-align:left;">
                <label style="cursor:pointer; display:inline-flex; align-items:center; gap:6px;">
                    <input type="checkbox" id="metaToggle" style="transform:scale(1.1);" />
                    <span>生成元数据 (meta.json)</span>
                </label>
                <label style="cursor:pointer; display:inline-flex; align-items:center; gap:6px; margin-left:18px;">
                    <input type="checkbox" id="fastStartToggle" checked style="transform:scale(1.1);" />
                    <span>⚡ 快速启动(跳过初始探测)</span>
                </label>
                <label style="cursor:pointer; display:inline-flex; align-items:center; gap:6px; margin-left:18px;">
                    <input type="checkbox" id="thumbnailToggle" style="transform:scale(1.1);" />
                    <span>🖼️ 下载封面图</span>
                </label>
                <span id="fastStartHint" style="margin-left:10px; color:#9ca3af;">(需先获取一次视频信息)</span>
            </div>

            <div class="options-row quality-section" id="qualitySection">
                <div class="option-group">
                    <label for="quality">质量选择</label>
                    <div class="radio-group">
                        <div class="radio-option">
                            <input type="radio" id="best" name="quality" value="best" checked>
                            <label for="best">🧠 自动推荐</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 字幕选择区域 -->
            <div class="subtitle-section">
                <div class="options-row">
                    <div class="option-group">
                        <label for="subtitles" id="subtitlesLabel">字幕选择</label>
                        <div class="subtitle-row">
                            <select id="subtitles">
                                <option value="">无字幕</option>
                            </select>
                            <button class="subtitle-btn" onclick="downloadSubtitles()">字幕下载</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 下载进度区域 -->
            <div class="progress-section">
                <div id="progress" style="display: none;">
                    <div class="progress-header">
                        <div class="progress-title" id="progressTitle">下载队列</div>
                        <div class="progress-url" id="progressUrl"></div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                    <div class="progress-stats">
                        <div class="progress-status" id="statusText">准备下载...</div>
                        <div class="progress-details">
                            <span id="progressPercent">0.0%</span>
                            <span id="remainingTime">--:--</span>
                        </div>
                    </div>
                    <div class="progress-actions">
                        <button class="cancel-btn" onclick="cancelDownload()">取消</button>
                    </div>
                </div>

                <!-- 日志区域 -->
                <div class="log-section">
                    <div class="log-header">
                        <h4 class="log-title">下载日志</h4>
                        <div class="log-actions" style="display:flex; gap:8px; flex-wrap:wrap;">
                            <button class="clear-btn" id="toggleLogBtn" onclick="toggleLogVisibility()">显示日志</button>
                            <button class="clear-btn" onclick="clearLogs()">🗑️ 清理日志</button>
                            <button class="clear-btn" onclick="openDownloadDir()">📂 打开目录</button>
                            <button class="clear-btn" id="revealLastBtn" onclick="revealLastFile()">🔍 最近文件</button>
                        </div>
                    </div>
                    <div id="logContainer" class="log-container" style="display: none;"></div>
                    <div class="log-stats-container" style="text-align: right; margin-top: 5px;">
                         <span id="logStats" style="font-size: 12px; color: #8899a6;">等待下载...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="start-text">输入链接以开始</div>
    </div>

    <script src="/static/main.js"></script>
</body>
</html>
